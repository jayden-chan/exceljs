{"version":3,"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","prototype","push","hyperlink","addHyperlink","SheetRelsWriter","module","exports","options","id","count","_hyperlinks","_workbook","workbook","stream","_stream","_openStream","length","each","fn","forEach","hyperlinksProxy","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","toString","startsWith","TargetMode","rId","_writeRelationship","address","addMedia","media","commit","_writeClose","end","_writeOpen","write","xmlEncode"],"mappings":"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","file":"sheet-rels-writer.js","sourcesContent":["/**\r\n * Copyright (c) 2015-2017 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar utils = require('../../utils/utils');\r\nvar RelType = require('../../xlsx/rel-type');\r\n\r\nvar HyperlinksProxy = function(sheetRelsWriter) {\r\n  this.writer = sheetRelsWriter;\r\n};\r\nHyperlinksProxy.prototype = {\r\n  push: function(hyperlink) {\r\n    this.writer.addHyperlink(hyperlink);\r\n  }\r\n};\r\n\r\nvar SheetRelsWriter = module.exports = function(options) {\r\n  // in a workbook, each sheet will have a number\r\n  this.id = options.id;\r\n\r\n  // count of all relationships\r\n  this.count = 0;\r\n\r\n  // keep record of all hyperlinks\r\n  this._hyperlinks = [];\r\n\r\n  this._workbook = options.workbook;\r\n};\r\nSheetRelsWriter.prototype = {\r\n\r\n  get stream() {\r\n    if (!this._stream) {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      this._stream = this._workbook._openStream('/xl/worksheets/_rels/sheet' + this.id + '.xml.rels');\r\n    }\r\n    return this._stream;\r\n  },\r\n\r\n  get length() {\r\n    return this._hyperlinks.length;\r\n  },\r\n\r\n  each: function(fn) {\r\n    return this._hyperlinks.forEach(fn);\r\n  },\r\n\r\n  get hyperlinksProxy() {\r\n    return this._hyperlinksProxy ||\r\n      (this._hyperlinksProxy = new HyperlinksProxy(this));\r\n  },\r\n  addHyperlink: function(hyperlink) {\r\n    // Write to stream\r\n    var relationship = {\r\n      Target: hyperlink.target,\r\n      Type: RelType.Hyperlink\r\n    };\r\n\r\n    if (!hyperlink.target.toString().startsWith(\"#\")) {\r\n      relationship.TargetMode = 'External';\r\n    }\r\n\r\n    var rId = this._writeRelationship(relationship);\r\n\r\n    // store sheet stuff for later\r\n    this._hyperlinks.push({\r\n      rId: rId,\r\n      address: hyperlink.address\r\n    });\r\n  },\r\n\r\n  addMedia: function(media) {\r\n    return this._writeRelationship(media);\r\n  },\r\n\r\n  commit: function() {\r\n    if (this.count) {\r\n      // write xml utro\r\n      this._writeClose();\r\n      // and close stream\r\n      this.stream.end();\r\n    }\r\n  },\r\n\r\n  // ================================================================================\r\n  _writeOpen: function() {\r\n    this.stream.write(\r\n      '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>' +\r\n      '<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">');\r\n  },\r\n  _writeRelationship: function(relationship) {\r\n    if (!this.count) {\r\n      this._writeOpen();\r\n    }\r\n\r\n    var rId = 'rId' + ++this.count;\r\n\r\n    if (relationship.TargetMode) {\r\n      this.stream.write(\r\n        '<Relationship' +\r\n        ' Id=\"' + rId + '\"' +\r\n        ' Type=\"' + relationship.Type + '\"' +\r\n        ' Target=\"' + utils.xmlEncode(relationship.Target) + '\"' +\r\n        ' TargetMode=\"' + relationship.TargetMode + '\"' +\r\n        '/>');\r\n    } else {\r\n      this.stream.write(\r\n        '<Relationship' +\r\n        ' Id=\"' + rId + '\"' +\r\n        ' Type=\"' + relationship.Type + '\"' +\r\n        ' Target=\"' + relationship.Target + '\"' +\r\n        '/>');\r\n    }\r\n\r\n\r\n    return rId;\r\n  },\r\n  _writeClose: function() {\r\n    this.stream.write('</Relationships>');\r\n  }\r\n};\r\n"]}